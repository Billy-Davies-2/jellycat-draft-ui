<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jellycat Fantasy Draft</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèà</text></svg>">
    <link href="/static/css/styles.css" rel="stylesheet">
    <!-- htmx for dynamic HTML updates -->
    <script src="https://unpkg.com/htmx.org@2.0.4" integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx-ext-sse@2.2.2" integrity="sha384-fw+eTlCc7suMV/1w/7fr2/PmwElUIt5i82bi+qTiLXvjRXZ2/FkiTNA/w0MhXnGI" crossorigin="anonymous"></script>
    <!-- Alpine.js for reactive client-side interactions -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.8/dist/cdn.min.js" integrity="sha384-X9kJyAubVxnP0hcA+AMMs21U445qsnqhnUF8EBlEpP3a42Kh/JwWjlv2ZcvGfphb" crossorigin="anonymous"></script>
    <style>
        /* Fallback: hide dropdown menu by default until Alpine.js initializes or JS handles it */
        [x-cloak] { display: none !important; }
        .dropdown-menu-hidden { display: none !important; }
        .dropdown-menu-visible { display: block !important; }
    </style>
</head>
<body class="min-h-screen" style="background: linear-gradient(135deg, #FFE5EC 0%, #E8D5F2 50%, #E0F2FE 100%); background-attachment: fixed;">
    <!-- Decorative football elements -->
    <div class="fixed top-10 right-10 text-6xl opacity-20 animate-float-slow pointer-events-none">üèà</div>
    <div class="fixed bottom-20 left-20 text-5xl opacity-20 animate-bounce-slow pointer-events-none">üß∏</div>
    <div class="fixed top-1/3 left-10 text-4xl opacity-15 animate-float pointer-events-none">üèà</div>
    <!-- User info bar (if authenticated) -->
    {{ if .User }}
    <div class="bg-white/90 backdrop-blur-sm border-b-2 border-pink-200 px-4 py-3 flex justify-between items-center shadow-soft" x-data="{ showMenu: false }">
        <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-700">Welcome, <strong class="text-gradient-jellycat font-display">{{ .User.Name }}</strong> <span class="text-xl">üß∏</span></span>
            {{ if .IsAdmin }}
            <a href="/admin" class="text-sm px-3 py-1.5 rounded-full bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 hover:from-purple-200 hover:to-pink-200 font-semibold transition-all duration-200">
                ‚ú® Admin Panel
            </a>
            {{ end }}
        </div>
        <div class="relative">
            <button id="userMenuBtn" @click="showMenu = !showMenu" onclick="toggleUserMenu()" class="flex items-center space-x-2 text-sm px-4 py-2 rounded-full bg-white border-2 border-pink-200 hover:border-pink-300 text-gray-700 hover:shadow-soft transition-all duration-200">
                <span class="font-semibold">{{ .User.Username }}</span>
                {{ if .IsAdmin }}<span class="text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded-full font-semibold">Admin</span>{{ end }}
                <svg id="userMenuArrow" class="w-4 h-4 transition-transform" :class="{ 'rotate-180': showMenu }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div id="userMenuDropdown" x-show="showMenu" 
                 x-cloak
                 x-transition:enter="transition ease-out duration-100"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-75"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 @click.away="showMenu = false" 
                 class="dropdown-menu-hidden absolute right-0 mt-2 w-48 bg-white rounded-2xl shadow-soft-lg py-2 z-50 border-2 border-pink-200">
                {{ if .IsAdmin }}
                <a href="/admin" class="block px-4 py-2.5 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-pink-50 hover:to-purple-50 font-medium rounded-xl mx-2">‚ú® Admin Panel</a>
                {{ end }}
                <a href="/auth/logout" class="block px-4 py-2.5 text-sm text-gray-700 hover:bg-gradient-to-r hover:from-pink-50 hover:to-purple-50 font-medium rounded-xl mx-2">üëã Logout</a>
            </div>
        </div>
    </div>
    {{ end }}
    
    {{ template "content" . }}
    <script>
        // Pure JS fallback for user menu (works when Alpine.js is blocked)
        var userMenuOpen = false;
        function toggleUserMenu() {
            // Only use this fallback if Alpine.js is not loaded
            if (typeof Alpine === 'undefined') {
                userMenuOpen = !userMenuOpen;
                var dropdown = document.getElementById('userMenuDropdown');
                var arrow = document.getElementById('userMenuArrow');
                if (dropdown) {
                    if (userMenuOpen) {
                        dropdown.classList.remove('dropdown-menu-hidden');
                        dropdown.classList.add('dropdown-menu-visible');
                    } else {
                        dropdown.classList.add('dropdown-menu-hidden');
                        dropdown.classList.remove('dropdown-menu-visible');
                    }
                }
                if (arrow) {
                    arrow.style.transform = userMenuOpen ? 'rotate(180deg)' : '';
                }
            }
        }
        
        // Close menu when clicking outside (fallback)
        document.addEventListener('click', function(e) {
            if (typeof Alpine === 'undefined') {
                var dropdown = document.getElementById('userMenuDropdown');
                var btn = document.getElementById('userMenuBtn');
                if (dropdown && btn && !btn.contains(e.target) && !dropdown.contains(e.target)) {
                    userMenuOpen = false;
                    dropdown.classList.add('dropdown-menu-hidden');
                    dropdown.classList.remove('dropdown-menu-visible');
                    var arrow = document.getElementById('userMenuArrow');
                    if (arrow) arrow.style.transform = '';
                }
            }
        });

        // Connect to SSE for realtime updates (only on pages without custom SSE handling)
        document.addEventListener('DOMContentLoaded', function() {
            // Skip SSE setup if Alpine.js draftApp or adminApp is handling it
            if (typeof draftApp === 'function' || typeof adminApp === 'function') {
                return;
            }
            
            const eventSource = new EventSource('/api/events');
            
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    if (data.type && data.type !== 'connected') {
                        // Trigger refresh of main content
                        htmx.trigger(document.body, 'sse-event');
                    }
                } catch (e) {
                    // Ignore parse errors for keepalive messages
                }
            };
            
            eventSource.onerror = function() {
                console.log('SSE connection error, will reconnect...');
            };
        });
    </script>
</body>
</html>
